<!DOCTYPE html>
<html>
    <head>
        <title>AgentEx</title>
        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
        <meta name="viewport" content="width=device-width">
        <script src="http://maps.googleapis.com/maps/api/js?key=AIzaSyAvLefR-lJTJPJInlS0Yy25zikwbitXXsk&sensor=false"></script>
        <script src="http://code.jquery.com/jquery-latest.min.js" type="text/javascript"></script>
        <script src="external_js_libraries/modernizr.custom.js"></script>
        <script src="external_js_libraries/three/three.min.js"></script>
        <script src="logging.js" type="text/javascript"></script>
        <script src="location.js"></script>
        <script src="sideMenu.js"></script>
        <script src="calcRoute.js"></script>
        <script src="route3d.js"></script>
        <script src="webCam.js"></script>
        <script src="/socket.io/socket.io.js"></script>
        <script src="communication.js"></script>
        <script src="getOrientation.js"></script>    
        <script src="drawMap.js"></script>
        <script src="fetchOwnCoords.js"></script>
        <script src="external_js_libraries/contextmenu/ContextMenu.js"></script>
        <link href='http://fonts.googleapis.com/css?family=Jura:400,600' rel='stylesheet' type='text/css'>
        <link rel="stylesheet" href="default.css">                   
    </head>
    <body>
        <section id="sideMenuSection" class="hidden">
            <div id="sideMenu" class="sidemenu">
                <!--
                <p>Side menu</p>
                <ul id="sideMenuObjectList">    
                </ul>
                -->
               
                 <img class="menuImg" src="images/homescreen_button.png" alt="home" onclick="homePressed();"/>          
                 <img class="menuImg" src="images/map_button.png" alt="map" onclick="mapPressed();"/>
                 <img class="menuImg" src="images/camera_button.png" alt="camera" onclick="cameraPressed();"/>
                
            </div>  
        </section>
       
        <section id="home">
            <div class="container">

                <div class="bubble">
                    {missionDescription}
                </div>
                <img src="images/agentti_torso_th.png" alt="agent"/>
                <div>
                    <input id="continueButton" type="button" onclick="toGame();" value="Continue mission"/>
                </div>
                <div class="block">
                    <img id="playerImg" src="images/kysymysmerkki_g.png" alt="pelaajankuva"/>
                    <ul id="playerInfo">
                        <li>Codename: {name}</li>
                        <li>Rank: {rank}</li>
                        <li>Missions: {missionCount}</li>
                    </ul>

                </div>
                <div class="block">
                    Most valuable agents
                    <table>
                        <tr>
                            <th>Codename</th>
                            <th>Missions</th>
                        </tr>
                        <tr>
                            <td>Superagent</td>
                            <td>23</td>
                        </tr>   
                        <tr>
                            <td>William</td>
                            <td>14</td>
                        </tr> 
                        <tr>
                            <td>Anon232</td>
                            <td>5</td>
                        </tr> 
                    </table>
                </div>

            </div>
            
            <div id="loginContainer" class="container">
                <input id="completeMission" type="button" onclick="congratulate();" value="Complete mission!"/>
            </div>
            
        </section>

        <section id="debug_status" class="hidden">
            <p>
                GammaX <span id="GammaX"></span><br/>
                BetaY <span id="BetaY"></span><br/>
                AlphaC <span id="AlphaC"></span><br/>
                Latitude <span id="Latitude"></span><br/>
                Longitude <span id="Longitude"></span><br/>
            </p>
        </section>

        <section id="map" class="hidden">
            <div id="mapContainer"></div>
        </section>

        <section id="cam" class="hidden">
            <canvas id="webCamCanvasFallback"></canvas>
            <video id="webCamCanvas" autoplay="autoplay"></video>

            <div id="route_3d"></div>
        </section>



        <section id="menuToggleSection" class="hidden">
            <div id="menuToggle" onclick="runMenuToggle();">
            </div>

        </section>
        
        <section id="congratulations" class="hidden">
            <div id="congratulationsContainer">
                <div class="bubble">
                    Congratulations! You have destroyed the artifact.
                </div>
                <img src="images/agentti_torso_th.png" alt="agent"/>
                <form action="Complete" method="post">
                    <input id="clientId" name="clientId" type="hidden"/>
                    <input id="finishedButton" type="submit" value="OK"/>
                </form>
            </div>
        </section>

        <input id="targetLat" type="hidden" value="{targetLatitude}"/>
        <input id="targetLong" type="hidden" value="{targetLongitude}"/>

        <script>
                window.onerror = function(message, url, linenumber) {
                        writeLog("JavaScript error: " + message + " on line " + linenumber + " for " + url);
                }
                        
                        function isElementVisible(id) {
                            var e = document.getElementById(id);
                            var state = window.getComputedStyle(e).display;
                            //console.log (state);

                            if (state != 'none')
                                return true;
                            else
                                return false;

                        }

                        function showElement(id) {
                            $('#' + id).removeClass('hidden');
                        }

                        function hideElement(id) {
                            $('#' + id).addClass('hidden');
                        }

                        function homePressed() {
                            localStorage.userLoggedIn = "0";
                            hideElement('map');
                            hideElement('cam');
                            hideElement('menuToggleSection');
                            hideElement('sideMenuSection');
                            
                            showElement('home');
                        }
                        
                        function cameraPressed() {
                            hideElement('home');
                            hideElement('map');
                            showElement('cam');
                            showElement('menuToggleSection');
                            webCam();
                        }

                        function mapPressed() {
                            hideElement('home');
                            hideElement('cam');
                            showElement('map');
                            drawMap();
                            showElement('menuToggleSection');
                            
                            
                        }

                        function toGame() {
                            localStorage.userLoggedIn = "1";
                            //showElement('debug_status');
                            mapPressed();
                            document.getElementById("menuToggle").style.backgroundImage = "url('images/showmenu_button.png')";   
                        }
                        
                        function congratulate() {
                            hideElement('home');
                            hideElement('cam');
                            hideElement('map');
                            showElement('congratulations');
                        }
                        
                        function start() {
                            writeLog("<check> Main.html loaded successfully");
                            localStorage.userLoggedIn = "0";   //nollataan tässä     
                            var id = Math.random();
                            fetchOwnCoords();
                            startCommunication(id);
                            localStorage.sessionId = id;
                            setOrientationListener();
                            var placeholder = document.getElementById('route_3d');
                            //writeLog("placeholder ="+placeholder);
                            route3dInit(placeholder);
                            
                        }

                        function loginPressed() {

                            localStorage.userLoggedIn = "1";

                            //writeLog("LoginPressed");
                            hideElement('home');
                            hideElement('cam');
                            showElement('map');
                            showElement('menuToggleSection');
                            showElement('debug_status');
                            //showElement('sideMenu');


                            var formfield = document.theForm.group1;
                            var startingOrientation = "default";
                            for (i = 0; i < formfield.length; i++)
                                if (formfield[i].checked == true)
                                    startingOrientation = formfield[i].value;
                            //writeLog(startingOrientation);
                            //getOrientation();

                            //This is the default case (we just trust sensors and getOrientation)
                            if (startingOrientation == 'sensor') {
                                return;
                            }

                            // These are useful if there are no sensors (even browser claims to support them)
                            if (startingOrientation == 'map') {
                                localStorage.orientationGammaX = -50;
                            }
                            else {
                                localStorage.orientationGammaX = -40;
                            }

                            //some sane default values
                            localStorage.orientationAlphaCompass = 0; //look to the north
                            localStorage.orientationBetaY = 0; //suppose screen is landscaped

                            //sectionChangeOnOrientationChange();
                            //orientationDataToHTML();
                        }


                        function runMenuToggle() {
                            if (isElementVisible('sideMenuSection')) {
                                hideElement('sideMenuSection');
                                document.getElementById("menuToggle").style.backgroundImage = "url('images/showmenu_button.png')";
                            } else {
                                showElement('sideMenuSection');
                                document.getElementById("menuToggle").style.backgroundImage = "url('images/hidemenu_button.png')";
                            }
                            


                        }
                        window.onload = start();
        </script> 
    </body>
</html>
